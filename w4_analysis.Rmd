---
title: "w4_analysis"
author: "Ben"
date: "9/24/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(janitor)
library(ggrepel)
library(gt)
library(grid)
library(broom)
library(lemon)

```

```{r}
treez <-  read_csv("w4/hurricane.csv")


liltrees <- read_csv("w4/hurricane_saplings.csv")

```

```{r clean col names}
treez <- clean_names(treez)

liltrees <- clean_names(liltrees)
```

```{r clean column types}
sapply(treez, class)

#convert dbh and azimuth to numeric
treez <- treez %>% mutate (degrees = parse_number(azimuth_degrees), dbh_cm = parse_number(dbh_cm_or_sap))

liltrees <- liltrees %>% mutate (sap_count = parse_number(sapling_count), seedlin_count = parse_number(seedling_count))
```

```{r make consistent values}
sapply(treez, unique)


treez %>% group_by(genus) %>% summarise( n = n())

treez <- treez %>% mutate( genus = recode(genus,
                                 B = "unknown",
                                 Beach = "beech",
                                 Beech= "beech", 
                                 "Bir ch" = "birch",
                                 Birch = "birch",
                                 "Dead?" = "unknown",
                                 "Oak" = "oak",
                                 "OAK" = "oak",
                                 oube = "unknown",
                                 "PB" = "birch",
                                 "Pine" = "pine",
                                 RM = "maple",
                                 SM = "maple",
                                 Maple = "maple",
                                 Unknown = "unknown",
                                 WP = "pine"
                                 ))


treez$standing_fallen %>% unique()

#recode standing fallen variable 
treez <- treez %>% mutate(standing_fallen = recode(standing_fallen,
                                          "F" = "Fallen",
                                          "f" = "Fallen",
                                          "S" = "Standing",
                                          "s" = "Standing"))

treez <- treez %>% mutate(site_h_c = recode(site_h_c,
                                          c = "Control Site",
                                          C = "Control Site",
                                          H = "Hurricane Site"))

```
	1. azimuths of fallen trees in the hurricane site (graph)
	2. azimuths of fallen trees in the control site (graph)

```{r}
c("North")

treez %>% filter( standing_fallen == "Fallen") %>%
  ggplot(aes(x = degrees, fill = genus)) +
  geom_histogram(binwidth = 24)+
  facet_wrap(~site_h_c, ncol = 1)+
  scale_x_continuous(breaks = c(0, 90, 180, 270, 360), labels = c("North (0)", "East(90)", "South(180)", "West(270)", "North(360)"))+xlab(NULL)
```
at the hurricane site, genus of fallen trees as a percentage of all fallen trees

```{r find proportions }
#fallen at hurricane 
fhp <- 
  treez %>%
  filter(site_h_c == "Hurricane Site") %>%
  filter(standing_fallen == "Fallen") %>%
  group_by(genus) %>%
  summarise(count = n())%>%
  mutate(Proportion = (count/sum(count)) %>% signif(digits = 2))

#standing hurricane 

shp <-
  treez %>%
  filter(site_h_c == "Hurricane Site") %>%
  filter(standing_fallen == "Standing") %>%
  group_by(genus) %>%
  summarise(count = n())%>%
  mutate(Proportion = (count/sum(count)) %>% signif(digits = 2))

#control fallen
fcp <- 
  treez %>%
  filter(site_h_c == "Control Site") %>%
  filter(standing_fallen == "Fallen") %>%
  group_by(genus) %>%
  summarise(count = n())%>%
  mutate(Proportion = (count/sum(count)) %>% signif(digits = 2))

#Control standing
scp <- 
  treez %>%
  filter(site_h_c == "Control Site") %>%
  filter(standing_fallen == "Standing") %>%
  group_by(genus) %>%
  summarise(count = n())%>%
  mutate(Proportion = 
           (count/sum(count)) %>% signif(digits = 2))

```
density (number per hectare) of seedlings, saplings, and trees of each genus growing on ground, fallen log, pit, or tip up mound in the affected site (graph)
```{r}
treez %>% 
  group_by(substrate_g_l_p_m)%>%
  summarise(numplot = length(unique(plot_number)))


unique(treez$plot_number)
```





```{r}
treez  %>%
  ggplot(aes( x = site_h_c, fill = genus))+ geom_bar()+ facet_wrap(~standing_fallen, ncol =1)
```

